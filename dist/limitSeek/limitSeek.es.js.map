{"version":3,"file":"limitSeek.es.js","sources":["../../packages/utils/event.ts","../../packages/limitSeek/src/index.ts"],"sourcesContent":["export interface DisposeEvent {\n  dispose(): void;\n}\n\nexport function addDomEvent(dom: HTMLElement, event: string, callback: (e: Event) => void): DisposeEvent {\n  dom.addEventListener(event, callback);\n  return {\n    dispose() {\n      dom.removeEventListener(event, callback);\n    }\n  };\n}\n","import { addDomEvent, DisposeEvent } from '../../utils/event';\n\nexport type LimitType = 'limit-all' | 'limit-not-see';\n\nexport interface LimitSeekOptions {\n  limitType: LimitType;\n  video: HTMLVideoElement;\n  /**\n   *  自定义初始的记录进度\n   */\n  timeRecord?: number\n}\n\nexport class LimitSeek {\n  /**\n   * video对象\n   */\n  video: HTMLVideoElement;\n\n  /**\n   * 限制类型\n   * limit-all 限制所有拖动\n   * limit-not-play 没观看的进度禁止拖动\n   */\n  limitType: LimitType;\n\n  /**\n   * 是否开启限制 0不开启 1开启\n   */\n  private status = 0;\n\n  /**\n   * 是否处于限制状态 0不是 1是\n   */\n  private inLimitStatus = 0;\n\n  /**\n   * 记录播放进度\n   */\n  private timeRecord = 0;\n\n  private disposeTimeUpdate?: DisposeEvent;\n\n  private disposeSeeked?: DisposeEvent;\n\n  constructor(options: LimitSeekOptions) {\n    this.video = options.video;\n    this.limitType = options.limitType || 'limit-all';\n\n    if (!this.video || typeof this.video.play !== 'function') return;\n\n    this.disposeTimeUpdate = addDomEvent(this.video, 'timeupdate', this.handleTimeUpdate);\n\n    this.disposeSeeked = addDomEvent(this.video, 'seeked', this.handleSeeked);\n\n    this.timeRecord = typeof options.timeRecord === 'number' ? options.timeRecord : 0;\n  }\n\n  private limitSeek() {\n    this.inLimitStatus = 1;\n    this.video.currentTime = this.timeRecord;\n  }\n\n  private handleTimeUpdate = () => {\n    const { currentTime } = this.video;\n    if (!this.status) return;\n\n    if (this.limitType === 'limit-not-see') {\n      if (currentTime - this.timeRecord > 1) {\n        this.limitSeek();\n      } else {\n        this.timeRecord = currentTime > this.timeRecord ? currentTime : this.timeRecord;\n      }\n    } else {\n      if (Math.abs(currentTime - this.timeRecord) < 1) {\n        this.timeRecord = currentTime;\n      } else {\n        this.limitSeek();\n      }\n    }\n  };\n\n  private handleSeeked = () => {\n    if (!this.status) return;\n\n    if (!this.inLimitStatus) {\n      if (\n        (this.limitType === 'limit-not-see' &&\n          this.video.currentTime > this.timeRecord) ||\n        this.limitType === 'limit-all'\n      ) {\n        this.limitSeek();\n      }\n    } else {\n      this.inLimitStatus = 0;\n    }\n  };\n\n  /**\n   * 开启限制拖动\n   */\n  start() {\n    this.status = 1;\n  }\n\n  /**\n   * 关闭限制拖动\n   */\n  stop() {\n    this.status = 0;\n  }\n\n  dispose() {\n    this.disposeTimeUpdate?.dispose();\n    this.disposeSeeked?.dispose();\n  }\n}\n"],"names":["addDomEvent","dom","event","callback","addEventListener","dispose","removeEventListener","options","this","currentTime","_this","video","status","limitType","timeRecord","limitSeek","Math","abs","inLimitStatus","play","disposeTimeUpdate","handleTimeUpdate","disposeSeeked","handleSeeked","LimitSeek"],"mappings":"SAIgBA,EAAYC,EAAkBC,EAAeC,GAE3D,OADAF,EAAIG,iBAAiBF,EAAOC,GACrB,CACLE,mBACEJ,EAAIK,oBAAoBJ,EAAOC,sBCqCnC,WAAYI,GAAZ,WAhBQC,YAAS,EAKTA,mBAAgB,EAKhBA,gBAAa,EAwBbA,sBAAmB,WACjB,IAAAC,EAAgBC,EAAKC,kBACxBD,EAAKE,SAEa,kBAAnBF,EAAKG,UACHJ,EAAcC,EAAKI,WAAa,EAClCJ,EAAKK,YAELL,EAAKI,WAAaL,EAAcC,EAAKI,WAAaL,EAAcC,EAAKI,WAGnEE,KAAKC,IAAIR,EAAcC,EAAKI,YAAc,EAC5CJ,EAAKI,WAAaL,EAElBC,EAAKK,cAKHP,kBAAe,WAChBE,EAAKE,SAELF,EAAKQ,cASRR,EAAKQ,cAAgB,GAPC,kBAAnBR,EAAKG,WACJH,EAAKC,MAAMF,YAAcC,EAAKI,YACb,cAAnBJ,EAAKG,YAELH,EAAKK,cA7CTP,KAAKG,MAAQJ,EAAQI,MACrBH,KAAKK,UAAYN,EAAQM,WAAa,YAEjCL,KAAKG,OAAoC,mBAApBH,KAAKG,MAAMQ,OAErCX,KAAKY,kBAAoBpB,EAAYQ,KAAKG,MAAO,aAAcH,KAAKa,kBAEpEb,KAAKc,cAAgBtB,EAAYQ,KAAKG,MAAO,SAAUH,KAAKe,cAE5Df,KAAKM,WAA2C,iBAAvBP,EAAQO,WAA0BP,EAAQO,WAAa,GA6DpF,OA1DUU,sBAAR,WACEhB,KAAKU,cAAgB,EACrBV,KAAKG,MAAMF,YAAcD,KAAKM,YAyChCU,kBAAA,WACEhB,KAAKI,OAAS,GAMhBY,iBAAA,WACEhB,KAAKI,OAAS,GAGhBY,oBAAA,6BACEhB,KAAKY,kCAAmBf,oBACxBG,KAAKc,8BAAejB"}